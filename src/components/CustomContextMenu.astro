---
// 自定义右键菜单组件
---

<!-- 右键菜单 -->
<div id="custom-context-menu" class="fixed hidden z-[9999] min-w-[180px] bg-[var(--card-bg)] border border-[var(--line-divider)] rounded-xl shadow-2xl overflow-hidden backdrop-blur-sm">
  <!-- 顶部导航图标 -->
  <div class="flex items-center justify-between px-3 py-2 border-b border-[var(--line-divider)] border-dashed">
    <button class="p-1.5 rounded-lg hover:bg-[var(--btn-card-bg-hover)] transition-colors text-75 hover:text-90" onclick="window.history.back()" title="后退">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
    </button>
    <button class="p-1.5 rounded-lg hover:bg-[var(--btn-card-bg-hover)] transition-colors text-75 hover:text-90" onclick="window.history.forward()" title="前进">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
      </svg>
    </button>
    <button class="p-1.5 rounded-lg hover:bg-[var(--btn-card-bg-hover)] transition-colors text-75 hover:text-90" onclick="window.location.reload()" title="刷新">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
    </button>
    <button class="p-1.5 rounded-lg hover:bg-[var(--btn-card-bg-hover)] transition-colors text-75 hover:text-90" onclick="window.location.href='/'" title="首页">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
      </svg>
    </button>
  </div>
  
  <!-- 菜单项 -->
  <div class="py-1">
    <a href="/archive/" class="flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
      </svg>
      <span>文章时间线</span>
    </a>
    
    <a href="/categories/" class="flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
      </svg>
      <span>文章分大类</span>
    </a>
    
    <a href="/tags/" class="flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
      </svg>
      <span>文章小标签</span>
    </a>
  </div>
  
  <!-- 分隔线 -->
  <div class="border-t border-[var(--line-divider)] border-dashed"></div>
  
  <!-- 第二组菜单项 -->
  <div class="py-1">
    <a href="/comments/" class="flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
      </svg>
      <span>随心留言板</span>
    </a>
    
    <button id="toggle-view-mode" class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
      </svg>
      <span>繁简模式切换</span>
    </button>
    
    <button onclick="window.print()" class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
      </svg>
      <span>打印整个页面</span>
    </button>
    
    <a href="/about/" class="flex items-center gap-3 px-4 py-2.5 text-sm text-75 hover:text-90 hover:bg-[var(--btn-card-bg-hover)] transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>网站声明</span>
    </a>
  </div>
</div>

<!-- 右上角提示通知 -->
<div id="context-menu-toast" class="fixed top-4 right-4 z-[10000] transform translate-x-full opacity-0 transition-all duration-500 ease-out">
  <div class="bg-[var(--card-bg)] border border-[var(--line-divider)] rounded-xl shadow-2xl px-4 py-3 flex items-center gap-3 min-w-[280px] backdrop-blur-sm">
    <div class="w-8 h-8 rounded-full bg-[var(--primary)]/10 flex items-center justify-center flex-shrink-0">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </div>
    <div class="flex-1">
      <p class="text-sm font-medium text-90">要恢复原版右键？</p>
      <p class="text-xs text-50 mt-0.5">按下 Ctrl/Control + 右键！</p>
    </div>
    <button onclick="hideContextMenuToast()" class="p-1 rounded-lg hover:bg-[var(--btn-card-bg-hover)] transition-colors text-50 hover:text-75">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
</div>

<script>
  // 自定义右键菜单功能
  (function() {
    const menu = document.getElementById('custom-context-menu');
    const toast = document.getElementById('context-menu-toast');
    let isMenuVisible = false;
    let toastTimeout: number | null = null;
    
    // 显示菜单
    function showMenu(x: number, y: number) {
      if (!menu) return;
      
      // 计算菜单位置，确保不超出视口
      const menuWidth = 180;
      const menuHeight = 320; // 估算高度
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      
      let posX = x;
      let posY = y;
      
      // 水平边界检查
      if (posX + menuWidth > viewportWidth) {
        posX = viewportWidth - menuWidth - 10;
      }
      
      // 垂直边界检查
      if (posY + menuHeight > viewportHeight) {
        posY = viewportHeight - menuHeight - 10;
      }
      
      menu.style.left = `${posX}px`;
      menu.style.top = `${posY}px`;
      menu.classList.remove('hidden');
      isMenuVisible = true;
      
      // 显示提示
      showToast();
    }
    
    // 隐藏菜单
    function hideMenu() {
      if (!menu) return;
      menu.classList.add('hidden');
      isMenuVisible = false;
    }
    
    // 显示提示通知
    function showToast() {
      if (!toast) return;
      
      // 清除之前的定时器
      if (toastTimeout) {
        clearTimeout(toastTimeout);
      }
      
      // 显示提示
      toast.classList.remove('translate-x-full', 'opacity-0');
      toast.classList.add('translate-x-0', 'opacity-100');
      
      // 3秒后自动隐藏
      toastTimeout = window.setTimeout(() => {
        hideToast();
      }, 3000);
    }
    
    // 隐藏提示通知
    function hideToast() {
      if (!toast) return;
      toast.classList.add('translate-x-full', 'opacity-0');
      toast.classList.remove('translate-x-0', 'opacity-100');
    }
    
    // 全局暴露隐藏函数
    (window as any).hideContextMenuToast = hideToast;
    
    // 右键事件监听
    document.addEventListener('contextmenu', function(e) {
      // 检查是否按下了 Ctrl 键
      if (e.ctrlKey || e.metaKey) {
        // 允许默认右键菜单
        hideMenu();
        return;
      }
      
      // 阻止默认右键菜单
      e.preventDefault();
      
      // 显示自定义菜单
      showMenu(e.clientX, e.clientY);
    });
    
    // 点击其他地方隐藏菜单
    document.addEventListener('click', function(e) {
      if (isMenuVisible && menu && !menu.contains(e.target as Node)) {
        hideMenu();
      }
    });
    
    // 滚动时隐藏菜单
    document.addEventListener('scroll', function() {
      if (isMenuVisible) {
        hideMenu();
      }
    }, true);
    
    // 窗口大小改变时隐藏菜单
    window.addEventListener('resize', function() {
      if (isMenuVisible) {
        hideMenu();
      }
    });
    
    // 键盘按下 Esc 隐藏菜单
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && isMenuVisible) {
        hideMenu();
      }
    });
    
    // 繁简切换功能
    const toggleBtn = document.getElementById('toggle-view-mode');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', function() {
        // 切换繁简模式
        const currentLang = document.documentElement.lang;
        if (currentLang === 'zh-CN') {
          document.documentElement.lang = 'zh-TW';
          localStorage.setItem('preferred-lang', 'zh-TW');
        } else {
          document.documentElement.lang = 'zh-CN';
          localStorage.setItem('preferred-lang', 'zh-CN');
        }
        hideMenu();
      });
    }
  })();
</script>

<style>
  #custom-context-menu {
    animation: menuFadeIn 0.15s ease-out;
  }
  
  @keyframes menuFadeIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  #custom-context-menu.hidden {
    display: none !important;
  }
  
  /* 菜单项悬停效果 */
  #custom-context-menu a,
  #custom-context-menu button {
    position: relative;
    overflow: hidden;
  }
  
  #custom-context-menu a::after,
  #custom-context-menu button::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--primary);
    transform: scaleY(0);
    transition: transform 0.2s ease;
  }
  
  #custom-context-menu a:hover::after,
  #custom-context-menu button:hover::after {
    transform: scaleY(1);
  }
</style>
